cd ../../../../gulp/src/github.com/megamsys/gulp

cd ../../../../../

=-------------------

#!/bin/bash

<%= @package_dir = @basic[:home]/@package[:package] %>

<%= @package_bin_dir = @package_dir/bin  %>

mkdir -p .<%= @package_bin_dir %>

cd <%= @package_dir/src/@package[:git_org]/gulp %>

# sometimes  the dependencies aren't getting pulled. Adding a master solved the problem.
git remote add master https://github.com/megamsys/gulp.git

make build

cp -rf ./conf/ ../../../../../<%= @package_dir %>

mv  gulpd <%=@package[:package] %>

cp <%=@package[:package] %> ../../../../../<%= @package_bin_dir %>

cat > VERSION << EOF
git_version=`git rev-parse HEAD`
git_branch="1.5"
EOF

cp VERSION ../../../../../<%= @package_dir %>

cd ../../../../../usr/share/megam/<%= @package[:package] %>

tar -zcvpf <%= @package[:package] %>.tar.gz bin conf VERSION

# md5sum <%= @package[:package] %>.tar.gz > <%= @package[:package] %>.tar.gz.md5
# s3cmd put --acl-public --guess-mime-type <%= @package[:package] %>.tar.gz.md5 s3://vertice/testing/1.5/<%= @package[:package] %>.tar.gz.md5
# s3cmd put --acl-public --guess-mime-type <%= @package[:package] %>.tar.gz s3://vertice/testing/1.5/<%= @package[:package] %>.tar.gz
# s3cmd put --acl-public --guess-mime-type VERSION s3://vertice/testing/1.5/VERSION

cd ../../../../

fpm -s dir -t deb  -f  --iteration <%= @basic[:iteration] %> -n <%= @package[:package] %> \
 -v <%= @basic[:version] %>  -d "<%= @package[:dependencies] %> " --after-install ./postinst --after-remove ./postrm  \
 --deb-upstart ./etc/init/<%= @package[:upstart_service] %> --license "<%= @basic[:license] %>" \
 --vendor "<%= @basic[:vendor] %>" --category "<%= @package[:category] %>" --maintainer "<%= @basic[:maintainer] %>" \
 --url "<%= @basic[:url] %>" --description "<%= @package[:description] %>"  .<%= @package_dir %>
